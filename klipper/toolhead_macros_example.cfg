# =============================================================
# Toolhead Macros with Spoolman Support
# =============================================================
# Add variable_spool_id: None to each of your T0-T3 toolchange
# macros so Fluidd can display and assign spools per toolhead.
#
# When an NFC tag is scanned:
#   1. The middleware calls SET_GCODE_VARIABLE to update spool_id
#   2. When the toolhead is next activated, SET_ACTIVE_SPOOL is called
#   3. Fluidd shows the correct spool for each toolhead
#
# NOTE: This is an EXAMPLE â€” your actual toolchange macros may differ.
# Add variable_spool_id: None and the SET_ACTIVE_SPOOL call to your
# existing T0-T3 macros in your toolboard config files.
# =============================================================

# T0 toolhead macro
# variable_spool_id is read by Fluidd to display per-toolhead spool assignment
[gcode_macro T0]
variable_color: ""
variable_tool_number: 0
variable_spool_id: None  # Set automatically by NFC scan via middleware
gcode:
  # Perform the toolchange
  _CHANGE_TOOL T={tool_number}
  # If a spool has been assigned to this toolhead via NFC scan,
  # notify Spoolman that this spool is now active for tracking
  {% if spool_id != None %}
    SET_ACTIVE_SPOOL ID={spool_id}
  {% endif %}

# T1 toolhead macro
[gcode_macro T1]
variable_color: ""
variable_tool_number: 1
variable_spool_id: None  # Set automatically by NFC scan via middleware
gcode:
  _CHANGE_TOOL T={tool_number}
  {% if spool_id != None %}
    SET_ACTIVE_SPOOL ID={spool_id}
  {% endif %}

# T2 toolhead macro
[gcode_macro T2]
variable_color: ""
variable_tool_number: 2
variable_spool_id: None  # Set automatically by NFC scan via middleware
gcode:
  _CHANGE_TOOL T={tool_number}
  {% if spool_id != None %}
    SET_ACTIVE_SPOOL ID={spool_id}
  {% endif %}

# T3 toolhead macro
[gcode_macro T3]
variable_color: ""
variable_tool_number: 3
variable_spool_id: None  # Set automatically by NFC scan via middleware
gcode:
  _CHANGE_TOOL T={tool_number}
  {% if spool_id != None %}
    SET_ACTIVE_SPOOL ID={spool_id}
  {% endif %}
